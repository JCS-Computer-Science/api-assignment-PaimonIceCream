<!DOCTYPE html>
 
<html lang="en">
 
<head>
    <meta charset="UTF-8">
 
    <title>Custom API Fetcher</title>
 
    <!--<link rel="stylesheet" href="style.css">-->
    <style>
        body{
            background-color: rgb(174, 228, 210);
        }
        div.button{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50% , -50%);
        }
        #menuDiv{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50% , -50%);
            display: none;
            text-align: center;
        }
        #listAPI{
            background-color: rgb(240, 239, 228);
            height: 300px;
            width: 500px;
        }
        #button{
            background-color: rgb(247, 228, 62);
            height: 100px;
            width: 200px;
            border: 6px double cadetblue;
            border-radius: 10px;
            font-family: Arial, sans-serif;
            font-size: 25px;
            text-shadow: 1px 1px green;
            transition: transform 1s;
        }
        #promiseHere{
            font-family: Arial, sans-serif;
            font-size: 25px;
            color:blue;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50% , -50%);
        }
        #errorID{
            transition: transform 1s;
        }
        @keyframes fadeIn{
            from {opacity: 0;}
            to {opacity: 1;}
        }
        @keyframes fadeOut{
            from {opacity: 1;}
            to {opacity: 0;}
        }
    </style>
    
</head>
 
<body>
    <!--<script src="app.js"></script>--> 
    <script>
        // Global variables
        var globalJSON;
        var removeBoolean;

        function fetchHandler() {
            var url = document.getElementById("fetchInput").value;
            
            fetch(url)  
                .then(response => { 
                    document.getElementById("valueID").innerHTML = " ";
                    return response.json();
                })   
                .then(response => {
                    let nodeList = document.getElementsByTagName("option").length;
                    
                    for (var i = 0; i < nodeList; i++){
                        let select = document.getElementById("keySelect");
                        select.remove(0);
                    }

                    const unselectedOption = document.createElement("option");
                    unselectedOption.id = "unselected";
                    unselectedOption.value = "unselcted";
                    unselectedOption.textContent = "Please Select a Key";
                    document.getElementById("keySelect").appendChild(unselectedOption);

                    let result = Object.keys(response);
                    
                    const dropdown = document.getElementById("keySelect");
                    result.forEach((key) =>  {
                        
                        let option = document.createElement("option");
                        option.id = key;
                        option.value = key;
                        option.textContent = key;
                        dropdown.appendChild(option);
                    })

                    globalJSON = response;
                    removeBoolean = true;
                    
                }) 
                .catch(error => {
                    console.log("ERROR");
                    console.error(error);
                    document.getElementById("valueID").innerHTML = "Please submit a valid response";
                    let nodeList = document.getElementsByTagName("option").length;
            
                    for (var i = 0; i < nodeList; i++){
                        let select = document.getElementById("keySelect");
                        select.remove(0);
                    }
                });        
        }

        function fetchChange(){
            if(removeBoolean == true){
                let select = document.getElementById("keySelect");
                select.remove(0);
                removeBoolean = false;
            }
            var whichKey = document.getElementById("keySelect").value;
            document.getElementById("valueID").innerHTML = globalJSON[whichKey];
            globalJSON[whichKey]
            console.log(globalJSON);
        }

        function addAPI(){
            let listAPI = document.getElementById("listAPI");
            let storeAPI = [document.createElement("p"), document.createTextNode(document.getElementById("APIadd").value)];
            storeAPI[0].onclick = () => removeP(event);

            listAPI.appendChild(storeAPI[0]);
            storeAPI[0].appendChild(storeAPI[1]);
        }

        function removeP(e){
            let listAPI = document.getElementById("listAPI");
            listAPI.removeChild(e.target);
        }
        
        /* Sets up the main menu */
        function setItUp(){
            const buttonOne = document.getElementById("button")
            buttonOne.style.transform = "translateY(-100%)";
            buttonOne.style.animation = "fadeOut 1s";
            setTimeout(() => {
                document.getElementById("button").style.display = "none";

                const menudiv = document.getElementById("menuDiv");
                menudiv.style.display = "inline";
                menuDiv.style.animation = "fadeIn 1s";
            }, 900);
            
            
        }

 
        // Changes the colour of the button
        setInterval(() => {
            var letters = "0123456789ABCDEF";
            var color = '#';
            for(let i = 0; i < 6; i++){
                color += letters[Math.floor(Math.random() * 16)];
            }
            document.getElementById("button").style.backgroundColor = color;
 
            letters = "0123456789ABCDEF";
            color = '#';
            for(let i = 0; i < 6; i++){
                color += letters[Math.floor(Math.random() * 16)];
            }
            document.getElementById("button").style.borderColor = color;
        }, 750)
 
 
    </script>
    
    <div class="button">
        <button id="button"; onclick = "setItUp()">Click Me</button>
    </div>

    <div id="menuDiv">
        <h1>Welcome!</h1>
        <h2>This is a little something that fetches data from an API.</h2>
        <input id="fetchInput"; type="text" ; placeholder="Fetch API URL Here">
        
        <select onchange="fetchChange()"; id="keySelect">
            <option id="unselected"; value="unselected">Please Enter a URL</option>
        </select>
        <button id="submitButton"; onclick ="fetchHandler()">Submit</button>

        <br><br>

        <input id="APIadd"; type="text"; placeholder="Store API URL Here">
        <button id="addButton"; onclick ="addAPI()">Store Api</button>

        <div id="listAPI">
            <p>https://www.boredapi.com/api/activity</p>
            <p onclick="removeP(this)">https://cat-fact.herokuapp.com/facts/random</p>
        </div>

        <br>
        
    

        <br>
        <div id = "valueID"></div>
    </div>
    
</body>
 
</html>